{% extends 'base.html' %}
{% load static %}
{% load leaflet_tags %}
{% load crispy_forms_tags %}

{% block extracss %}
  {% leaflet_css %}
  {% leaflet_css plugins="forms" %}
{% endblock %}

{% block extrajs %}
  {% leaflet_js %}
  {% leaflet_js plugins="forms" %}
{% endblock %}

{% block content %}

<div class="col col-lg-10 card">
  <div class="card-body">
    <h2 class="card-title">{{location}}</h2>
    <small class="form-text text-muted">Subhead text.</small>
    <br />

    <table id="locations-list" class="table table-responsive-sm table-bordered rounded card-text">
    <thead>
    </thead>
    <tbody>
        <tr>
          <td style="width:30%"><b>Agency:</b></td>
          <td>{{location.agency}}</td>
        </tr>

        <tr>
          <td><b>Country:</b></td>
          <td>{{location.country}}</td>
        </tr>

        {% if location.region %}
        <tr>
          <td><b>Region:</b></td>
          <td>{{location.region}}</td>
        </tr>
        {% endif %}

        {% if location.city %}
        <tr>
          <td><b>City:</b></td>
          <td>{{location.city}}</td>
        </tr>
        {% endif %}

        <tr>
          <td><b>Primary Name:</b></td>
          <td>{{location.name_primary}}</td>
        </tr>

        {% if name_secondary %}
        <tr>
          <td><b>Secondary Name:</b></td>
          <td>{{location.name_secondary}}</td>
        </tr>
        {% endif %}

        {% if location.character %}
        <tr>
          <td><b>Character:</b></td>
          <td>{{location.character}}</td>
        </tr>
        {% endif %}

        <tr>
          <td><b>Geometry:</b></td>
          <td>{% leaflet_map "main" callback="main_map_init" %}</td>
        </tr>

        {% if geometry_type %}
        <tr>
          <td><b>Geometry Type:</b></td>
          <td>{{location.geometry_type}}</td>
        </tr>
        {% endif %}
    </tbody>
    </table>

  <a class="btn btn-secondary float-right" href="{% url 'locations-list' %}">Back to location list</a>
  </div>
</div>

<script type="text/javascript">
  function main_map_init (map, options) {
    var raw_data = '{{location.geometry.geojson|escapejs}}';
    var data = JSON.parse(raw_data);
    L.geoJson(data).addTo(map);
  }
</script>

{% endblock %}
