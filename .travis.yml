branches:
  only:
  - master
  - "/^v0.*$/"
language: python
python:
- '3.6'
install:
- pip install --upgrade pip
- pip install -r requirements.txt
addons:
  postgresql: '9.6'
  apt:
    packages:
    - postgresql-9.6-postgis-2.3
before_script:
- psql -c 'create database "just-spaces";' -U postgres
- psql -U postgres -d travis -c "create extension postgis"
- mv justspaces/local_settings.example.py justspaces/local_settings.py
script:
- python manage.py migrate
notifications:
  webhooks:
  - https://semabot.datamade.us/travis/
deploy:
  provider: codedeploy
  access_key_id: AKIAJNYGDLOJKHOUWCAA
  secret_access_key:
    secure: ckhgoxbbPDdvFcSpp49olwaj37jNZFDWd0D9cFb1nJge+L5dP5HG41sOOFnQNo4Be2dGmOzmWQqj0rpxaUrkN6gfStkc8DJehTtXvEXbMovgndBYJQvh+TGj9Uf6y8xja71Aeecw4hzkeqwiEfSD9ATdJmcQetd4t6jXKBZ765w+EmJQq0czg8z6cJfgw8ikUzCkP/sKPijSs+qdHIc9B7po6PtpttnWl6cSKa9nlmLos7X6RaBs1sJpojxaBOa343yqZ2DTAxpH7cmO4G1++tVXLPNZZRBmCyFIBqQGsA+J8mqVPUhfwJoAiepINDBtZGIF27oF4t3HMG3yNIgLmsl3Ya4z4quzZ3XmEG0oics3ea54aU/81eeLbluGV/QwTa6Vk9H+pJ+VlGAkIS14XU2BhrfvlqLTOnbJ/bv16KP0jvtzQ8yZHrRv0pFUN3zgdywnvtVePVFHAvGavQEzthCjgeHSQrkz1BrEpmNCQnkiFamm95zN/tqQxRGiklCTCm0rWMr/VXKW5SIKHfj3hinPW1nP7lKzllhFUON5YKABjVhZoCx2SG8+VFFCBtfNW/q9IQEChBFRMQZxrR8ZyshUke2JO3wONsbnwTCEFffrZBb8c+4Xp/W8V0TgFpuUIODgEtxVfkx5Q4AMhgtbu+pnPFYar8X1Q62+LTUUMd8=
  application: just-spaces
  deployment_group: staging
  on:
    repo: master
