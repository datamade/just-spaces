branches:
  only:
  - master
  - "/^v0.*$/"
language: python
python:
- '3.6'
services:
- docker
install:
- pip install --upgrade pip
- pip install -r requirements.txt
- docker-compose build
addons:
  postgresql: '9.6'
  apt:
    packages:
    - postgresql-9.6-postgis-2.3
before_script:
- psql -c 'create database "just-spaces";' -U postgres
- psql -U postgres -d travis -c "create extension postgis"
- mv justspaces/local_settings.example.py justspaces/local_settings.py
script:
- python manage.py migrate
- pytest
- docker-compose run --rm frontend lint
- docker-compose run --rm frontend test
notifications:
  slack:
    rooms:
     - secure: T7rFUOr3HU7xBt5O3d0BlxASAk/zLLFc8gsguFq2ZFv/MgOdUUEECYPXi8JTYh8xGtOayZzUG44xjZbow+R6JB/Sxiy0VJpYlkyf13zwYtsA5ybnsJNmX3/BO3Ch9IrT7wUyZQAXbZNsPMyi+nH4HrzoZB8ZkwD8IQcp01yJM+A4YFhsbtWOS8GHasm55UsnP05TWhJkAWpOt6LtPKzm4mUWPJ1fE+GN5Bx+kK9L1giBB60AAMLpdfbXvxZu5erQZ7hKALDldgYeJpbofiawhiouDAsh/e2mbTD9RgJJLNlxNWMPkkVKOmHUXRePit69znFW81vYCpF3tJb02wjTjQdqDVxGfYpYNKN4e+aIo0Fkj//guQb+khAdy//1SG1Q+5OJEsIT35w3H+fMsrecuCgPzLf8lFlkI9CEreozZQSK19++kWtqndaS2/z6e1p/DA4vxnsoQ0fT9gen3mzd6DKmm0/Dm3NTmqm6sGjKQvNcnrrCaOrIcHvuh/QVkFghyMwaHEHWntTh3AwKvau7iQ/ULpif6H5TW5YO3XBmdS2XPiJYXstA8x67TXXCytnDijLCkE2KusSMCSoCjp9EgHSQN610kcs22w7lhObyNl8a+aSKcFHNXbHFZGTYvvEJeqx8z+9vh7acSEc17dydKLu+arXPxtzMjJxQwhyQSJs=
deploy:
  provider: codedeploy
  access_key_id: AKIAJNYGDLOJKHOUWCAA
  secret_access_key:
    secure: sRKWoVSKeDFABEHSKBVEZHZ7h+tW8rbKcNKbnIiwGFG6+2tg5iMI//XPZ1ttFkEkTl9eEOcs6ZJ4meFq6f7Ky9mNFNQLIFGswpCihkkly3d0ry5jgBF2JLYpRsaKS+RB0o7i2NhRVfcGATSa02katTZsHxzV6bL+WVwMIBHdgOmsANR2A36FEDOYY09ee0vKdXKIaFvQg6FM/eb1QHrtbQ72D9y6eTaHtLrowzF41sdIfA2yx3aL7ZxHytfeSkr93nY6zycT6Y5B/Q72wRT91rHcGhA03A0IJdPJMBIDDU6bITg1MfyJTmonXIrSZQrDQjYSVcy2Eaj/UecOqHFHdGbMddTIq9ILWBewXWDqD0Yv2JeeXw5QmT6npIek/brxpe9H1SPeHgINXWu0sKEdmXbjGnH5Wm82TxIzNzDd5TzuoF5OEN+DW+QbFZYZ+wHYhPcG8hQ6TZylIH97kN+5KCFKAIZ4QSFFqc9TgbrnAIr4Na46PlmyUEioeN3hy4AUp/e25iHQvI+eYqX9SahQM/grjKT3EotdyyRLHn56lF9MptTLuHroIFMRMjrmBs3TMClb2E0oNQHZ8x7e/oOjLxfthGOAPqvBpGJ+dbRiTUFZQ7SouquaX4mVw/NGNqTg3ZTVPXwObEj4/ur4alCXaVzF+eCvDjLOqOEQdxulG3s=
  application: just-spaces
  deployment_group: staging
  on:
    repo: datamade/just-spaces
    branch: master
