branches:
  only:
  - master
  - "/^v0.*$/"
language: python
python:
- '3.6'
install:
- pip install --upgrade pip
- pip install -r requirements.txt
addons:
  postgresql: '9.6'
  apt:
    packages:
    - postgresql-9.6-postgis-2.3
before_script:
- psql -c 'create database "just-spaces";' -U postgres
- psql -U postgres -d travis -c "create extension postgis"
- mv justspaces/local_settings.example.py justspaces/local_settings.py
script:
- python manage.py migrate
notifications:
  webhooks:
  - https://semabot.datamade.us/travis/
deploy:
  provider: codedeploy
  access_key_id: AKIAJNYGDLOJKHOUWCAA
  secret_access_key:
    secure: FxmOsYfiRZoKn3JXGlqMuoZDxWDWB4pS4TZKV5zcIldNlzKY/4JMuQV9l96RokJcpQ/PJ6thjryHL5b5NHDU12pFwK3GyKpITMJqR6Hu3SgewcbS24sxWVurbXbg+BCJ/nQAtOA5Jh/ZFkYfnewrrZHE0bHSlDRAwbnPHaZ+H9B5hxOWT1o+mrGg8cK+xzoZQULs5RmXp/KcOIpx/2d+huFqj1gS/SrfAaL2/qh/5vQT9xBwhO4y5gUy9yHV4YVV5MNEtEzkW6yDzSO2HS1TnWYqGl0u2mMofMD1vbMh/c82OgZ+wu0DTh/2Y/WCcx6kw0MnS/n+BvQimUzm9zULIjgAJ1yzIhSIFkJYveK8JvaFuXyrD+gSyrMPkKt6jqL+Tdi5ujEEk3Q2/feKLl8I1D54WP45R2S7b6fvsWHH6/5qNxQ2Cvv/OhXY3Gbo6jQ5bC+49UvljYrByM6MObORRLd/SaZ79BZMKqFoo1gWM+gtb3YuQnimont7NAFVXmTifgPDc/m1mDDPmVstAEtHA5K5bTbO2xFVD0o+dw7lMW2WSeck5cgeIJm63Z4er71vToSSN9D494VETvrG/K8tSyXKFt34YZhdLD8KWfNadrLKXvManwiWiVsJEnXALoSWDDLHv5R6Ou+edYUPcwUZOCBsmyJ8vS5N47Y01EEL8zM=
  application: just-spaces
  deployment_group: staging
  on:
    repo: datamade/just-spaces
