branches:
  only:
  - master
  - "/^v0.*$/"
language: python
python:
- '3.6'
services:
- 'docker'
install:
- pip install --upgrade pip
- pip install -r requirements.txt
- docker-compose build
addons:
  postgresql: '9.6'
  apt:
    packages:
    - postgresql-9.6-postgis-2.3
before_script:
- psql -c 'create database "just-spaces";' -U postgres
- psql -U postgres -d travis -c "create extension postgis"
- mv justspaces/local_settings.example.py justspaces/local_settings.py
script:
- python manage.py migrate
- pytest
- docker-compose run --rm frontend lint
- docker-compose run --rm frontend test
notifications:
  slack:
    secure: FdZaB7zLLP1CujlCeY51A0Go0Yx2KPRmIJnXK8u5ufeoQs0Zvc93dkH7GSF7gIVRRRC33+Qat+Q9iNt6B3rq8k7K0jyBIbwuANFBCRhrDUq+LwL2SFR8kN8sfNj683U55ijpqyf9VGW1W+pboevKHAqvbdz28lgxdKrxKIbcDY2PnKjnv/C8LRNEiCNkzJe3i7Vd/m7Zg0gbF5N3GyKXRINmPFohVreVOHhhAYwqaPKh25HAnpDmbuMRFtIHrNnMbdDWRwOj8XF873MsONzES7S6mOpRhfuDSA/2jPc4sX1iVbUMjynjVGRCkxGtjOM3TEPyxn/A1hMh6grsaqRRzyDwerve5Cv8n1moJLwA3dXh+Mr5DYhHcZ7bUWLUsPGUIHh7j9Hdxidvt7Ej5/I819z9zrfaSq4wxCUsTfPBn/6hcl2R7xGoHnIz4rC7NKSVZn3ECKyrX3AVwDcP94VdbsT1SxFpOg8XzeNNdCeIFY3MxbI8Zxfs1D34t6KFhCCag0sleN7Ix/r7ILYWG0ml12eesNnlGOsyf6jYd/Z7T0CmsmuOrvG8FpqdUan8rP8HZdYXyjfJokjpmYvNe7OnRlb6ug6jqZ7vMnEgpJxZEJ6eujY9Mz4fC36YRxqaQnXLXoc9xRYs37Jo8vCkNxO0v6I15Vhyaqy+786J9IQoh34=
deploy:
  provider: codedeploy
  access_key_id: AKIAJNYGDLOJKHOUWCAA
  secret_access_key:
    secure: sRKWoVSKeDFABEHSKBVEZHZ7h+tW8rbKcNKbnIiwGFG6+2tg5iMI//XPZ1ttFkEkTl9eEOcs6ZJ4meFq6f7Ky9mNFNQLIFGswpCihkkly3d0ry5jgBF2JLYpRsaKS+RB0o7i2NhRVfcGATSa02katTZsHxzV6bL+WVwMIBHdgOmsANR2A36FEDOYY09ee0vKdXKIaFvQg6FM/eb1QHrtbQ72D9y6eTaHtLrowzF41sdIfA2yx3aL7ZxHytfeSkr93nY6zycT6Y5B/Q72wRT91rHcGhA03A0IJdPJMBIDDU6bITg1MfyJTmonXIrSZQrDQjYSVcy2Eaj/UecOqHFHdGbMddTIq9ILWBewXWDqD0Yv2JeeXw5QmT6npIek/brxpe9H1SPeHgINXWu0sKEdmXbjGnH5Wm82TxIzNzDd5TzuoF5OEN+DW+QbFZYZ+wHYhPcG8hQ6TZylIH97kN+5KCFKAIZ4QSFFqc9TgbrnAIr4Na46PlmyUEioeN3hy4AUp/e25iHQvI+eYqX9SahQM/grjKT3EotdyyRLHn56lF9MptTLuHroIFMRMjrmBs3TMClb2E0oNQHZ8x7e/oOjLxfthGOAPqvBpGJ+dbRiTUFZQ7SouquaX4mVw/NGNqTg3ZTVPXwObEj4/ur4alCXaVzF+eCvDjLOqOEQdxulG3s=
  application: just-spaces
  deployment_group: staging
  on:
    repo: datamade/just-spaces
    branch: master
